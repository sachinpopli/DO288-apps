#!/bin/bash

echo "Performing the S2I build..."

#TODO: add call to the standard S2I assemble script

/usr/libexec/s2i/assemble
npm cache clean --force
rm -rf /opt/app-root/src/.npm/node_modules
rm -rf /opt/app-root/src/node_modules
rm -rf /opt/app-root/node-modules
rm /opt/app-root/package-lock.json
rm /opt/app-root/src/package-lock.json
npm install

rc=$?

if [ $rc -eq 0 ]; then
    echo "Recording successful build on the life cycle management system..."
else
    echo "Not calling the life cycle management system: S2I build failed!"
fi
exit $rc
